services:
  # ——— BACKEND: NestJS + better-auth ———
  - type: web
    name: acme-backend
    env: node
    region: frankfurt
    plan: free
    buildCommand: |
      cd backend
      
      # Install all dependencies (including dev dependencies)
      npm install --production=false
      
      # Generate Prisma client
      npx prisma generate
      
      # Run database migrations
      npx prisma migrate deploy
      
      # Build the NestJS application
      npm run build
      
    startCommand: cd backend && npm run start:prod
    healthCheckPath: /health
    envVars:
      - key: DATABASE_URL
        generateValue: true
      - key: DIRECT_URL
        generateValue: true
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_APP_URL
        sync: false  # Set this manually to your Render backend URL
      - key: SMTP_USER
        sync: false  # Set this manually
      - key: SMTP_PASS
        sync: false  # Set this manually
      - key: PORT
        value: 10000

  # ——— FRONTEND: Next.js App Router ———
  - type: web
    name: acme-takehome
    env: node
    region: frankfurt
    plan: free
    buildCommand: |
      cd frontend
      npm install
      npm run build
    startCommand: cd frontend && npm run start
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_APP_URL
        value: https://acme-backend.onrender.com  # Your backend URL
      - key: NEXT_PUBLIC_BETTER_AUTH_URL
        value: https://acme-backend.onrender.com  # Same as backend URL